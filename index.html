<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RuneScape 3 Repeatables Checklist</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --background-color: #ecf0f1;
            --card-background: #ffffff;
            --text-color: #2c3e50;
            --border-color: #bdc3c7;
            --completed-bg: #d5f4e6;
            --task-spacing: 12px;
            --task-padding: 12px;
            --task-gap: 12px;
            --task-columns: 1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--card-background);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        .hamburger-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s ease;
            backdrop-filter: blur(10px);
        }

        .hamburger-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .profile-icon {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 16px;
            font-weight: 600;
            padding: 10px 15px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
            min-width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .profile-icon:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .profile-icon.active {
            background: var(--success-color);
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.3);
        }

        /* Hamburger Menu Panel */
        .hamburger-menu {
            position: fixed;
            top: 0;
            left: -350px;
            width: 350px;
            height: 100vh;
            background: var(--card-background);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transition: left 0.3s ease-in-out;
            overflow-y: auto;
        }

        .hamburger-menu.open {
            left: 0;
        }

        .hamburger-menu-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .hamburger-menu-title {
            font-size: 1.2em;
            font-weight: 600;
        }

        .hamburger-close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
            transition: background 0.2s ease;
        }

        .hamburger-close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .hamburger-menu-content {
            padding: 20px;
        }

        .hamburger-section {
            margin-bottom: 30px;
        }

        .hamburger-section h3 {
            color: var(--primary-color);
            font-size: 1.1em;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--secondary-color);
        }

        .hamburger-reset-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .hamburger-reset-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s ease;
            text-align: left;
        }

        .hamburger-reset-btn:hover {
            background: #c0392b;
            transform: translateY(-1px);
        }

        .hamburger-reset-btn.monthly {
            background: #8e44ad;
        }

        .hamburger-reset-btn.monthly:hover {
            background: #732d91;
        }

        .hamburger-reset-btn.weekly {
            background: #2980b9;
        }

        .hamburger-reset-btn.weekly:hover {
            background: #1f618d;
        }

        .hamburger-reset-btn.daily {
            background: #f39c12;
        }

        .hamburger-reset-btn.daily:hover {
            background: #d68910;
        }

        .hamburger-control-group {
            margin-bottom: 20px;
        }

        .hamburger-control-group label {
            display: block;
            font-size: 0.9em;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        .hamburger-density-slider {
            width: 100%;
            height: 5px;
            background: #ddd;
            outline: none;
            opacity: 0.7;
            transition: opacity 0.2s;
            border-radius: 5px;
            margin-bottom: 5px;
        }

        .hamburger-density-slider:hover {
            opacity: 1;
        }

        .hamburger-density-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--secondary-color);
            cursor: pointer;
            border-radius: 50%;
        }

        .hamburger-density-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--secondary-color);
            cursor: pointer;
            border-radius: 50%;
            border: none;
        }

        .hamburger-columns-select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            background: white;
            color: var(--primary-color);
            font-size: 0.9em;
            cursor: pointer;
        }

        .hamburger-columns-select:focus {
            outline: none;
            border-color: var(--secondary-color);
        }

        /* Profile Dropdown Menu */
        .profile-dropdown {
            position: absolute;
            top: 55px;
            right: 0;
            background: var(--card-background);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            min-width: 250px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
        }

        .profile-dropdown.open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .profile-dropdown-header {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .profile-dropdown-current {
            font-size: 0.9em;
            color: var(--text-color);
            margin-bottom: 10px;
        }

        .profile-dropdown-select {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            background: white;
            color: var(--primary-color);
            font-size: 0.9em;
        }

        .profile-dropdown-select:focus {
            outline: none;
            border-color: var(--secondary-color);
        }

        .profile-dropdown-actions {
            padding: 10px;
            display: flex;
            gap: 8px;
        }

        .profile-dropdown-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .profile-dropdown-btn.create {
            background: var(--success-color);
            color: white;
        }

        .profile-dropdown-btn.create:hover {
            background: #229954;
        }

        .profile-dropdown-btn.delete {
            background: var(--accent-color);
            color: white;
        }

        .profile-dropdown-btn.delete:hover:not(:disabled) {
            background: #c0392b;
        }

        .profile-dropdown-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        /* Menu Backdrop */
        .menu-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .menu-backdrop.show {
            opacity: 1;
            visibility: visible;
        }

        /* Show Hidden Tasks Button */
        .show-hidden-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            margin-left: 10px;
            transition: background 0.2s ease;
        }

        .show-hidden-btn:hover {
            background: var(--primary-color);
        }

        .show-hidden-btn.active {
            background: var(--accent-color);
        }

        /* Task Hiding Context Menu */
        .task-context-menu {
            position: absolute;
            background: var(--card-background);
            border-radius: 5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            z-index: 1001;
            min-width: 150px;
            opacity: 0;
            visibility: hidden;
            transform: scale(0.95);
            transition: all 0.2s ease;
        }

        .task-context-menu.show {
            opacity: 1;
            visibility: visible;
            transform: scale(1);
        }

        .task-context-menu-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9em;
            color: var(--text-color);
            transition: background 0.2s ease;
        }

        .task-context-menu-item:last-child {
            border-bottom: none;
        }

        .task-context-menu-item:hover {
            background: var(--background-color);
        }

        .task-context-menu-item.hide {
            color: var(--accent-color);
        }

        /* Hidden task styles */
        .task-item.hidden,
        .subtask-item.hidden {
            display: none !important;
        }

        /* Mobile Responsive Styles for new components */
        @media (max-width: 768px) {
            .hamburger-menu {
                width: 100vw;
                left: -100vw;
            }

            .hamburger-menu.open {
                left: 0;
            }

            .profile-dropdown {
                right: -10px;
                min-width: 200px;
            }

            .header-controls {
                top: 15px;
                left: 15px;
                right: 15px;
            }

            .hamburger-btn, .profile-icon {
                padding: 12px;
                font-size: 18px;
            }

            .profile-icon {
                min-width: 40px;
                height: 40px;
                font-size: 14px;
            }

            .hamburger-reset-buttons {
                gap: 12px;
            }

            .hamburger-reset-btn {
                padding: 14px 16px;
                font-size: 1em;
            }

            .show-hidden-btn {
                font-size: 0.7em;
                padding: 4px 8px;
                margin-left: 5px;
            }
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .progress-section {
            background: var(--background-color);
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .controls-section {
            background: var(--background-color);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
            justify-content: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .control-group label {
            font-size: 0.9em;
            font-weight: 600;
            color: var(--primary-color);
        }

        .density-slider {
            width: 150px;
            height: 5px;
            background: #ddd;
            outline: none;
            opacity: 0.7;
            transition: opacity 0.2s;
            border-radius: 5px;
        }

        .density-slider:hover {
            opacity: 1;
        }

        .density-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--secondary-color);
            cursor: pointer;
            border-radius: 50%;
        }

        .density-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--secondary-color);
            cursor: pointer;
            border-radius: 50%;
            border: none;
        }

        .columns-select {
            padding: 8px 12px;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            background: white;
            color: var(--primary-color);
            font-size: 0.9em;
            cursor: pointer;
        }

        .columns-select:focus {
            outline: none;
            border-color: var(--secondary-color);
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), #2ecc71);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            font-weight: bold;
            color: var(--primary-color);
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary-color);
        }

        /* For sections with collapse buttons */
        .section-header:has(.collapse-toggle) {
            justify-content: space-between;
        }

        .section-header-left {
            display: flex;
            align-items: center;
        }

        /* Handle both old and new header structures */
        .section-header h2,
        .section-header-left h2 {
            font-size: 1.8em;
            color: var(--primary-color);
            margin-left: 10px;
        }

        .section-emoji {
            font-size: 1.5em;
        }

        /* Fallback for browsers that don't support :has() */
        @supports not (selector(:has(*))) {
            .section-header {
                justify-content: flex-start;
            }
            
            /* Specifically target collapsible sections */
            .section-header .collapse-toggle {
                margin-left: auto;
            }
        }

        .collapse-toggle {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.2s ease;
        }

        .collapse-toggle:hover {
            background: var(--primary-color);
        }

        .collapse-toggle.collapsed::after {
            content: " ‚ñº";
        }

        .collapse-toggle:not(.collapsed)::after {
            content: " ‚ñ≤";
        }

        .collapsible-content {
            transition: max-height 0.3s ease, opacity 0.3s ease;
            overflow: hidden;
        }

        .collapsible-content.collapsed {
            max-height: 0;
            opacity: 0;
        }

        .collapsible-content:not(.collapsed) {
            max-height: 2000px;
            opacity: 1;
        }

        .subsection {
            margin-bottom: 25px;
        }

        .subsection h3 {
            font-size: 1.3em;
            color: var(--secondary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .subsection h3::before {
            content: "";
            width: 4px;
            height: 20px;
            background: var(--secondary-color);
            margin-right: 10px;
            border-radius: 2px;
        }

        .task-list {
            list-style: none;
            display: grid;
            grid-template-columns: repeat(var(--task-columns), 1fr);
            gap: var(--task-gap);
        }

        .task-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: var(--task-spacing);
            padding: var(--task-padding);
            border-radius: 8px;
            transition: all 0.2s ease;
            border: 1px solid transparent;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .task-item:hover {
            background: #f8f9fa;
            border-color: var(--border-color);
            cursor: pointer;
        }

        .task-item.completed {
            background: var(--completed-bg);
            opacity: 0.8;
        }

        .task-checkbox {
            margin-right: 12px;
            margin-top: 2px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .task-content {
            flex: 1;
        }

        .task-name {
            font-weight: 600;
            color: var(--primary-color);
        }

        .task-link {
            color: var(--secondary-color);
            text-decoration: none;
            margin-left: 8px;
        }

        .task-link:hover {
            text-decoration: underline;
        }

        .task-note {
            font-style: italic;
            color: #7f8c8d;
            margin-left: 8px;
        }

        .subtask-list {
            margin-top: 8px;
            margin-left: 20px;
        }

        .subtask-item {
            margin-bottom: 6px;
            padding: 6px;
            border-radius: 4px;
            transition: all 0.2s ease;
            display: flex;
            align-items: flex-start;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .subtask-item:hover {
            background: #f0f0f0;
        }

        .subtask-item.completed {
            background: #e8f5e8;
            opacity: 0.8;
        }

        .section-divider {
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--border-color), transparent);
            margin: 30px 0;
        }

        .notes-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }

        .notes-section h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .notes-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .note-item {
            padding: 8px;
            background: white;
            border-radius: 4px;
            border-left: 4px solid var(--secondary-color);
        }

        .footer {
            text-align: center;
            padding: 20px;
            background: var(--background-color);
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .reset-buttons {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .reset-button {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.2s ease;
        }

        .reset-button:hover {
            background: #c0392b;
        }

        .reset-button-monthly {
            background: #8e44ad;
        }

        .reset-button-monthly:hover {
            background: #732d91;
        }

        .reset-button-weekly {
            background: #2980b9;
        }

        .reset-button-weekly:hover {
            background: #1f618d;
        }

        .reset-button-daily {
            background: #f39c12;
        }

        .reset-button-daily:hover {
            background: #d68910;
        }

        /* Profile Section Styles */
        .profile-section {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .profile-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .profile-select {
            padding: 8px 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 14px;
            min-width: 200px;
        }

        .profile-select option {
            background: var(--primary-color);
            color: white;
        }

        .profile-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
            background: var(--success-color);
            color: white;
        }

        .profile-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .profile-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .delete-btn {
            background: var(--accent-color);
        }

        .delete-btn:hover:not(:disabled) {
            background: #c0392b;
        }

        .current-profile {
            text-align: center;
            font-size: 16px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
        }

        .current-profile.active {
            color: #2ecc71;
        }

        @media (max-width: 768px) {
            .profile-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .profile-select {
                min-width: auto;
            }
        }

        /* Timer Styles */
        .reset-timer {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-left: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.2);
            min-width: 120px;
            text-align: center;
            font-family: 'Courier New', monospace;
            letter-spacing: 0.5px;
        }

        .reset-timer.daily {
            background: linear-gradient(135deg, #f39c12, #d68910);
        }

        .reset-timer.weekly {
            background: linear-gradient(135deg, #2980b9, #1f618d);
        }

        .reset-timer.monthly {
            background: linear-gradient(135deg, #8e44ad, #732d91);
        }

        .reset-timer.expired {
            background: linear-gradient(135deg, #27ae60, #229954);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .auto-reset-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            font-weight: 600;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .auto-reset-notification.show {
            transform: translateX(0);
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
            }

            .content {
                padding: 20px;
            }

            .section-header h2 {
                font-size: 1.5em;
            }

            .reset-timer {
                margin-left: 8px;
                font-size: 0.75em;
                padding: 4px 8px;
                min-width: 100px;
            }

            .section-header-left {
                flex-wrap: wrap;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <!-- Header Controls -->
            <div class="header-controls">
                <button id="hamburgerBtn" class="hamburger-btn">‚ò∞</button>
                <button id="profileIcon" class="profile-icon">?</button>
            </div>
            
            <h1>üè∞ RuneScape 3 Repeatables</h1>
            <p>Track your daily, weekly, and monthly tasks efficiently</p>
        </div>

        <!-- Hamburger Menu -->
        <div id="hamburgerMenu" class="hamburger-menu">
            <div class="hamburger-menu-header">
                <div class="hamburger-menu-title">Settings & Controls</div>
                <button id="hamburgerCloseBtn" class="hamburger-close-btn">√ó</button>
            </div>
            <div class="hamburger-menu-content">
                <div class="hamburger-section">
                    <h3>Reset Progress</h3>
                    <div class="hamburger-reset-buttons">
                        <button class="hamburger-reset-btn" onclick="resetProgress()">Reset All Progress</button>
                        <button class="hamburger-reset-btn monthly" onclick="resetMonthlyProgress()">Reset Monthlies</button>
                        <button class="hamburger-reset-btn weekly" onclick="resetWeeklyProgress()">Reset Weeklies</button>
                        <button class="hamburger-reset-btn daily" onclick="resetDailyProgress()">Reset Dailies</button>
                    </div>
                </div>
                
                <div class="hamburger-section">
                    <h3>Display Settings</h3>
                    <div class="hamburger-control-group">
                        <label for="hamburgerDensitySlider">Task Density</label>
                        <input type="range" id="hamburgerDensitySlider" class="hamburger-density-slider" min="1" max="5" value="3">
                        <span id="hamburgerDensityValue">Normal</span>
                    </div>
                    <div class="hamburger-control-group">
                        <label for="hamburgerColumnsSelect">Columns</label>
                        <select id="hamburgerColumnsSelect" class="hamburger-columns-select">
                            <option value="1">1 Column</option>
                            <option value="2">2 Columns</option>
                            <option value="3">3 Columns</option>
                            <option value="4">4 Columns</option>
                        </select>
                    </div>
                </div>

                <div class="hamburger-section">
                    <h3>Task Hiding</h3>
                    <div class="hamburger-control-group">
                        <label>
                            <input type="checkbox" id="useGlobalHiding"> Use Global Task Hiding
                        </label>
                        <small style="color: #7f8c8d; margin-top: 5px; display: block;">
                            When enabled, hidden tasks apply to all profiles. When disabled, each profile has its own hidden tasks.
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Dropdown -->
        <div id="profileDropdown" class="profile-dropdown">
            <div class="profile-dropdown-header">
                <div class="profile-dropdown-current">Current Profile:</div>
                <select id="profileDropdownSelect" class="profile-dropdown-select">
                    <option value="">Select Profile...</option>
                </select>
            </div>
            <div class="profile-dropdown-actions">
                <button id="profileDropdownCreate" class="profile-dropdown-btn create">Create</button>
                <button id="profileDropdownDelete" class="profile-dropdown-btn delete" disabled>Delete</button>
            </div>
        </div>

        <!-- Menu Backdrop -->
        <div id="menuBackdrop" class="menu-backdrop"></div>

        <!-- Task Context Menu -->
        <div id="taskContextMenu" class="task-context-menu">
            <div class="task-context-menu-item hide" onclick="hideTask()">Hide Task</div>
        </div>

        <div class="progress-section">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">0% Complete (0/0 tasks)</div>
        </div>


        <div class="content">
            <!-- Monthly Tasks -->
            <div class="section">
                <div class="section-header">
                    <div class="section-header-left">
                        <span class="section-emoji">üìÖ</span>
                        <h2>Monthly Tasks</h2>
                        <span class="reset-timer" id="monthly-timer">Loading...</span>
                        <button class="show-hidden-btn" onclick="toggleHiddenTasks('monthly')" id="showHiddenMonthly" style="display: none;">Show Hidden</button>
                    </div>
                    <button class="collapse-toggle" onclick="toggleCollapse('monthly-tasks')">Collapse</button>
                </div>
                <div id="monthly-tasks" class="collapsible-content">
                    <ul class="task-list">
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="monthly-slomon">
                        <div class="task-content">
                            <span class="task-name">Slomon's Store</span>
                            <a href="https://secure.runescape.com/m=mtxn_rs_shop/index?jptg=ia&jptv=sgs_page#category/FreeItem" class="task-link" target="_blank">Microtransaction Shop</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="monthly-premier">
                        <div class="task-content">
                            <span class="task-name">Premier Vault</span>
                            <a href="https://runescape.wiki/w/Premier_Club_Vault" class="task-link" target="_blank">Wiki Guide</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="monthly-oyster">
                        <div class="task-content">
                            <span class="task-name">Giant Oyster</span>
                            <a href="https://runescape.wiki/w/Giant_Oyster" class="task-link" target="_blank">Wiki Guide</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="monthly-troll">
                        <div class="task-content">
                            <span class="task-name">Troll Invasion</span>
                            <a href="https://runescape.wiki/w/Troll_Invasion" class="task-link" target="_blank">Wiki Guide</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="monthly-statues">
                        <div class="task-content">
                            <span class="task-name">God Statues</span>
                            <a href="https://runescape.wiki/w/God_Statues" class="task-link" target="_blank">Wiki Guide</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="monthly-effigy">
                        <div class="task-content">
                            <span class="task-name">Effigy Incubator</span>
                            <a href="https://runescape.wiki/w/Effigy_Incubator" class="task-link" target="_blank">Wiki Guide</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="monthly-pyroclasts">
                        <div class="task-content">
                            <span class="task-name">Add Infernus Pyroclasts</span>
                            <span class="task-note">for Ultracompost</span>
                        </div>
                    </li>
                    </ul>
                </div>
            </div>

            <!-- Weekly Tasks -->
            <div class="section">
                <div class="section-header">
                    <div class="section-header-left">
                        <span class="section-emoji">üìÖ</span>
                        <h2>Weekly Tasks</h2>
                        <span class="reset-timer" id="weekly-timer">Loading...</span>
                        <button class="show-hidden-btn" onclick="toggleHiddenTasks('weekly')" id="showHiddenWeekly" style="display: none;">Show Hidden</button>
                    </div>
                    <button class="collapse-toggle" onclick="toggleCollapse('weekly-tasks')">Collapse</button>
                </div>
                <div id="weekly-tasks" class="collapsible-content">
                    <ul class="task-list">
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="weekly-citadel">
                        <div class="task-content">
                            <span class="task-name">Cap Clan Citadel</span>
                            <a href="https://runescape.wiki/w/Clan_Citadel" class="task-link" target="_blank">Wiki Guide</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="weekly-thalmund">
                        <div class="task-content">
                            <span class="task-name">Thalmund's Wares</span>
                            <a href="https://runescape.wiki/w/Thalmund%27s_Wares" class="task-link" target="_blank">Wiki Guide</a>
                            <span class="task-note">(Wednesday)</span>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="weekly-aquarium">
                        <div class="task-content">
                            <span class="task-name">Aquarium Treasure Chest</span>
                            <a href="https://runescape.wiki/w/Treasure_chest_decoration" class="task-link" target="_blank">Wiki Guide</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="weekly-meg">
                        <div class="task-content">
                            <span class="task-name">Meg's Questions</span>
                            <a href="https://runescape.wiki/w/Meg#Meg's_questions" class="task-link" target="_blank">Wiki Guide</a>
                            <span class="task-note">(Use Arc Journal)</span>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="weekly-water">
                        <div class="task-content">
                            <span class="task-name">Water Filtration</span>
                            <a href="https://runescape.wiki/w/Water_filtration_system" class="task-link" target="_blank">Wiki Guide</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="weekly-tears">
                        <div class="task-content">
                            <span class="task-name">Tears of Guthix</span>
                            <a href="https://runescape.wiki/w/Tears_of_Guthix" class="task-link" target="_blank">Wiki Guide</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="weekly-herby">
                        <div class="task-content">
                            <span class="task-name">Herby Werby</span>
                            <a href="https://runescape.wiki/w/Herby_Werby" class="task-link" target="_blank">Wiki Guide</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="weekly-penguin">
                        <div class="task-content">
                            <span class="task-name">Penguin Hide and Seek</span>
                            <a href="http://2016.world60pengs.com/" class="task-link" target="_blank">World 60 Pengs</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="weekly-shattered">
                        <div class="task-content">
                            <span class="task-name">Shattered Worlds Challenges</span>
                            <a href="https://runescape.wiki/w/Shattered_Worlds" class="task-link" target="_blank">Wiki Guide</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="weekly-familiar">
                        <div class="task-content">
                            <span class="task-name">Familiarisation</span>
                            <a href="https://runescape.wiki/w/Familiarisation" class="task-link" target="_blank">Wiki Guide</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="weekly-skeletal">
                        <div class="task-content">
                            <span class="task-name">Skeletal Horror</span>
                            <a href="https://runescape.wiki/w/Skeletal_horror" class="task-link" target="_blank">Wiki Guide</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="weekly-agoroth">
                        <div class="task-content">
                            <span class="task-name">Agoroth</span>
                            <a href="https://runescape.wiki/w/Agoroth" class="task-link" target="_blank">Wiki Guide</a>
                            <span class="task-note">(2x per week)</span>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="weekly-broken">
                        <div class="task-content">
                            <span class="task-name">Replay Broken Home</span>
                            <a href="https://runescape.wiki/w/Broken_Home/Quick_guide" class="task-link" target="_blank">Quick Guide</a>
                            <span class="task-note">(No death speed run <37 min, max 1 food)</span>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="weekly-rush">
                        <div class="task-content">
                            <span class="task-name">Rush of Blood</span>
                            <a href="https://runescape.wiki/w/Rush_of_Blood" class="task-link" target="_blank">Wiki Guide</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="weekly-gwd2">
                        <div class="task-content">
                            <span class="task-name">GWD2 Bounties</span>
                            <a href="https://runescape.wiki/w/Feng,_the_Bounty_Master" class="task-link" target="_blank">Feng, the Bounty Master</a>
                        </div>
                    </li>
                    </ul>
                </div>
            </div>

            <div class="section-divider"></div>

            <!-- Daily Tasks -->
            <div class="section">
                <div class="section-header">
                    <div class="section-header-left">
                        <span class="section-emoji">üìÖ</span>
                        <h2>Daily Tasks</h2>
                        <span class="reset-timer" id="daily-timer">Loading...</span>
                        <button class="show-hidden-btn" onclick="toggleHiddenTasks('daily')" id="showHiddenDaily" style="display: none;">Show Hidden</button>
                    </div>
                </div>

                <!-- Time-gated Dailies -->
                <div class="subsection">
                    <h3>‚è∞ Time-gated Dailies</h3>
                    <ul class="task-list">
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="daily-dsf">
                            <div class="task-content">
                                <span class="task-name">DSF Merchant</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="daily-star">
                            <div class="task-content">
                                <span class="task-name">Shooting Star D&D</span>
                                <span class="task-note">'Starfind' FC</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="daily-obelisk">
                            <div class="task-content">
                                <span class="task-name">Menaphos Obelisks</span>
                                <a href="https://runescape.wiki/w/Soul_obelisk_(Menaphos)" class="task-link" target="_blank">Soul Obelisk Guide</a>
                                <span class="task-note">'SoulObby' FC</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="daily-cache">
                            <div class="task-content">
                                <span class="task-name">Guthixian Cache</span>
                                <a href="https://runescape.wiki/w/Guthixian_Cache" class="task-link" target="_blank">Wiki Guide</a>
                                <span class="task-note">(2x daily)</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="daily-sinkhole">
                            <div class="task-content">
                                <span class="task-name">Sinkholes</span>
                                <a href="https://runescape.wiki/w/Sinkholes" class="task-link" target="_blank">Wiki Guide</a>
                                <span class="task-note">(2x daily)</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="daily-runesphere">
                            <div class="task-content">
                                <span class="task-name">Runesphere</span>
                                <a href="https://runescape.wiki/w/Runesphere" class="task-link" target="_blank">Wiki Guide</a>
                                <span class="task-note">(25K XP)</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="daily-wilderness">
                            <div class="task-content">
                                <span class="task-name">Wilderness Flash Events</span>
                                <a href="https://runescape.wiki/w/Wilderness_flash_events" class="task-link" target="_blank">Wiki Guide</a>
                            </div>
                        </li>
                    </ul>
                </div>

                <!-- Non-Time-gated Dailies -->
                <div class="subsection">
                    <h3>üîÑ Non-Time-gated Dailies</h3>
                    <ul class="task-list">
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="daily-reaper">
                            <div class="task-content">
                                <span class="task-name">Soul Reaper Task</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="daily-ports">
                            <div class="task-content">
                                <span class="task-name">Player-owned Ports</span>
                                <a href="https://runescape.wiki/w/Player-owned_port" class="task-link" target="_blank">Port Guide</a>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="daily-fixate">
                            <div class="task-content">
                                <span class="task-name">Fixate Charges</span>
                                <span class="task-note">3x Daily (Red Rum Relics II / III)</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="daily-nemi">
                            <div class="task-content">
                                <span class="task-name">Nemi Forest</span>
                                <a href="https://runescape.wiki/w/Nemi_Forest" class="task-link" target="_blank">Wiki Guide</a>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="daily-chinchompa">
                            <div class="task-content">
                                <span class="task-name">Big Chinchompa</span>
                                <a href="https://runescape.wiki/w/Big_Chinchompa" class="task-link" target="_blank">Wiki Guide</a>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="daily-fish">
                            <div class="task-content">
                                <span class="task-name">Fish Flingers</span>
                                <a href="https://runescape.wiki/w/Fish_Flingers" class="task-link" target="_blank">Wiki Guide</a>
                                <span class="task-note">(2x entry tickets)</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="daily-arc">
                            <div class="task-content">
                                <span class="task-name">Arc Contracts</span>
                                <a href="https://runescape.wiki/w/Contract" class="task-link" target="_blank">Contract Guide</a>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="daily-bolts">
                            <div class="task-content">
                                <span class="task-name">Bakriminel Bolts</span>
                                <a href="https://runescape.wiki/w/Money_making_guide/Fletching_bakriminel_bolts" class="task-link" target="_blank">Money Making Guide</a>
                                <span class="task-note">(Every 6 hours)</span>
                            </div>
                        </li>
                    </ul>
                </div>

                <!-- Infrequent Dailies -->
                <div class="subsection">
                    <h3>üìâ Infrequent Dailies</h3>
                    <ul class="task-list">
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="daily-mazcab">
                            <div class="task-content">
                                <span class="task-name">Liberation of Mazcab Raids</span>
                                <a href="https://runescape.wiki/w/Liberation_of_Mazcab" class="task-link" target="_blank">Raid Guide</a>
                                <span class="task-note">'Raid FC' every 2 days</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="daily-phoenix">
                            <div class="task-content">
                                <span class="task-name">Phoenix Lair</span>
                                <a href="https://runescape.wiki/w/Phoenix_Lair" class="task-link" target="_blank">Wiki Guide</a>
                                <span class="task-note">(Time consuming)</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="daily-bork">
                            <div class="task-content">
                                <span class="task-name">Bork</span>
                                <a href="https://runescape.wiki/w/Bork" class="task-link" target="_blank">Wiki Guide</a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Fort Forinthry Section -->
            <div class="section">
                <div class="section-header">
                    <div class="section-header-left">
                        <span class="section-emoji">üè∞</span>
                        <h2>Start at Fort Forinthry</h2>
                        <button class="show-hidden-btn" onclick="toggleHiddenTasks('fort')" id="showHiddenFort" style="display: none;">Show Hidden</button>
                    </div>
                </div>
                <ul class="task-list">
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="fort-challenges">
                        <div class="task-content">
                            <span class="task-name">Daily Challenges</span>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="fort-miscellania">
                        <div class="task-content">
                            <span class="task-name">Miscellania</span>
                            <a href="https://runescape.wiki/w/Calculator:Other/Miscellania" class="task-link" target="_blank">Calculator</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="fort-archaeology">
                        <div class="task-content">
                            <span class="task-name">Archaeology Research</span>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="fort-bonus-xp">
                        <div class="task-content">
                            <span class="task-name">Fort Forinthry Bonus XP</span>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="fort-kitchen">
                        <div class="task-content">
                            <span class="task-name">Fort Forinthry Kitchen Supplies</span>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="fort-herblore">
                        <div class="task-content">
                            <span class="task-name">Fort Forinthry Herblore Supplies</span>
                            <div class="subtask-list">
                                <div class="subtask-item">
                                    <input type="checkbox" class="task-checkbox" data-task="fort-vials">
                                    <span class="task-name">Vials</span>
                                </div>
                                <div class="subtask-item">
                                    <input type="checkbox" class="task-checkbox" data-task="fort-eye-newt">
                                    <span class="task-name">Eye of newt</span>
                                </div>
                                <div class="subtask-item">
                                    <input type="checkbox" class="task-checkbox" data-task="fort-herb-supplies">
                                    <span class="task-name">Herblore supplies</span>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="fort-slayer-shop">
                        <div class="task-content">
                            <span class="task-name">Slayer Master Shop</span>
                            <div class="subtask-list">
                                <div class="subtask-item">
                                    <input type="checkbox" class="task-checkbox" data-task="fort-slayer-broad-arrows">
                                    <span class="task-name">Broad Arrow Heads</span>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="fort-invention">
                        <div class="task-content">
                            <span class="task-name">Invention Machines</span>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="fort-helms">
                        <div class="task-content">
                            <span class="task-name">Modified Skilling Helms Collection</span>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="fort-jack">
                        <div class="task-content">
                            <span class="task-name">Jack of All Trades</span>
                            <a href="https://runescape.wiki/w/Jack_of_trades_aura/Routines" class="task-link" target="_blank">Routines Guide</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="fort-auras">
                        <div class="task-content">
                            <span class="task-name">Activate Premier XP Boost and Wisdom Aura</span>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="fort-char">
                        <div class="task-content">
                            <span class="task-name">Book of Char</span>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="fort-serenity">
                        <div class="task-content">
                            <span class="task-name">Priff Serenity Posts</span>
                            <span class="task-note">(Agility Gear + Ancient Teleport Seed)</span>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="mining-gorajo-card">
                        <div class="task-content">
                            <span class="task-name">Gorajo Card</span>
                            <a href="https://runescape.wiki/w/Gorajo_card" class="task-link" target="_blank">Wiki Guide</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="mining-divine-locations">
                        <div class="task-content">
                            <span class="task-name">Divine Locations</span>
                            <a href="https://runescape.wiki/w/Divine_location" class="task-link" target="_blank">Wiki Guide</a>
                        </div>
                    </li>
                </ul>
            </div>

            <div class="section-divider"></div>

            <!-- POF Gear & Burthorpe Section -->
            <div class="section">
                <div class="section-header">
                    <div class="section-header-left">
                        <span class="section-emoji">üê∑</span>
                        <h2>Equip POF Gear & Advance Time Runes & TP to Burthorpe</h2>
                        <button class="show-hidden-btn" onclick="toggleHiddenTasks('pof')" id="showHiddenPof" style="display: none;">Show Hidden</button>
                    </div>
                </div>
                <ul class="task-list">
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="pof-slayer-shop">
                        <div class="task-content">
                            <span class="task-name">Slayer Master Shop</span>
                            <div class="subtask-list">
                                <div class="subtask-item">
                                    <input type="checkbox" class="task-checkbox" data-task="pof-broad-arrows">
                                    <span class="task-name">Broad Arrow Heads</span>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="pof-buy-runes">
                        <div class="task-content">
                            <span class="task-name">Buy Runes</span>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="pof-taverley-flies">
                        <div class="task-content">
                            <span class="task-name">Zoom to Taverley and buy flies from pet shop</span>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="pof-jatix">
                        <div class="task-content">
                            <span class="task-name">Jatix Herblore Supplies</span>
                            <div class="subtask-list">
                                <div class="subtask-item">
                                    <input type="checkbox" class="task-checkbox" data-task="pof-jatix-vials">
                                    <span class="task-name">Vials</span>
                                </div>
                                <div class="subtask-item">
                                    <input type="checkbox" class="task-checkbox" data-task="pof-jatix-eye-newt">
                                    <span class="task-name">Eye of newt</span>
                                </div>
                                <div class="subtask-item">
                                    <input type="checkbox" class="task-checkbox" data-task="pof-jatix-herb-supplies">
                                    <span class="task-name">Herblore supplies</span>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="pof-betamax">
                        <div class="task-content">
                            <span class="task-name">Betamax TP Bags</span>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="pof-anachronia-dino">
                        <div class="task-content">
                            <span class="task-name">Anachronia Dino Farm</span>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="pof-manor-farm">
                        <div class="task-content">
                            <span class="task-name">Ardougne Manor Farm</span>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="pof-pure-essence">
                        <div class="task-content">
                            <span class="task-name">Pure Essence Wizard Comperty</span>
                        </div>
                    </li>
                </ul>
            </div>

            <div class="section-divider"></div>

            <!-- Craft Runes Section -->
            <div class="section">
                <div class="section-header">
                    <div class="section-header-left">
                        <span class="section-emoji">üîÆ</span>
                        <h2>Craft Runes - Equip Normal RC Loadout</h2>
                        <button class="show-hidden-btn" onclick="toggleHiddenTasks('rc')" id="showHiddenRc" style="display: none;">Show Hidden</button>
                    </div>
                </div>
                
                <div class="subsection">
                    <h3>üí∞ Profitable Runes</h3>
                    <p style="margin-bottom: 15px; font-style: italic; color: #7f8c8d;">
                        <a href="https://runescape.wiki/w/Money_making_guide/Buying_runes" class="task-link" target="_blank">Money Making Guide</a>
                    </p>
                    <ul class="task-list">
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="rc-vis-wax-check">
                            <div class="task-content">
                                <span class="task-name">Check daily Vis Wax rune using RC Cape</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="rc-edgeville-tp">
                            <div class="task-content">
                                <span class="task-name">Edgeville TP</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="rc-craft-abyss">
                            <div class="task-content">
                                <span class="task-name">Craft Fire/Astral Runes from Abyss</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="rc-red-mage">
                            <div class="task-content">
                                <span class="task-name">Edgeville TP - Runes from Red Mage</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="rc-mage-arena">
                            <div class="task-content">
                                <span class="task-name">Edgeville TP - Lever TP - Mage Arena Shop</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="rc-port-sarim">
                            <div class="task-content">
                                <span class="task-name">Port Sarim TP - Runes Betty</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="rc-void-knight">
                            <div class="task-content">
                                <span class="task-name">Void Knight Outpost TP</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="rc-varrock">
                            <div class="task-content">
                                <span class="task-name">Varrock TP - Runes from Aubury</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="rc-yanille">
                            <div class="task-content">
                                <span class="task-name">Yanille TP - Sand from Bert and Runes from Wizard Tower</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="rc-lunar-isle">
                            <div class="task-content">
                                <span class="task-name">Lunar Isle TP - Runes from Baba Yaga</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="rc-anachronia">
                            <div class="task-content">
                                <span class="task-name">Anachronia TP - Runes from Store Assistant</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="rc-manage-base">
                            <div class="task-content">
                                <span class="task-name">Manage Anachronia Base</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="rc-craft-vis-wax">
                            <div class="task-content">
                                <span class="task-name">Craft Vis Wax at Wizard's Tower</span>
                                <a href="https://runescape.wiki/w/Rune_Goldberg_Machine" class="task-link" target="_blank">Vis Vax</a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="section-divider"></div>

            <!-- Mining Gear Section -->
            <div class="section">
                <div class="section-header">
                    <div class="section-header-left">
                        <span class="section-emoji">‚õèÔ∏è</span>
                        <h2>Equip Mining Gear & Resourceful Aura & Premier Porter Buff & Ancient Teleport Seed & Porters</h2>
                        <button class="show-hidden-btn" onclick="toggleHiddenTasks('mining')" id="showHiddenMining" style="display: none;">Show Hidden</button>
                    </div>
                </div>
                
                <div class="subsection">
                    <h3>üèùÔ∏è TP to Oo'glog</h3>
                    <ul class="task-list">
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="mining-red-sandstone">
                            <div class="task-content">
                                <span class="task-name">Mine Red Sandstone</span>
                                <div class="subtask-list">
                                    <div class="subtask-item">
                                        <input type="checkbox" class="task-checkbox" data-task="mining-thermal-flasks">
                                        <span class="task-name">Thermal Flasks / Flasks</span>
                                        <span class="task-note">(Use Artificer's Measure + Portables while crafting)</span>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="mining-meat-packs">
                            <div class="task-content">
                                <span class="task-name">Buy Meat Packs</span>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="subsection">
                    <h3>üè∞ TP to Prifddinas</h3>
                    <ul class="task-list">
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="mining-crystal-sandstone">
                            <div class="task-content">
                                <span class="task-name">Mine Crystal Sandstone</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="mining-crystal-blossom">
                            <div class="task-content">
                                <span class="task-name">Get Crystal Tree Blossom</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="mining-coeden-logs">
                            <div class="task-content">
                                <span class="task-name">Logs from Coeden</span>
                                <a href="https://runescape.wiki/w/Coeden" class="task-link" target="_blank">Wiki Guide</a>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="mining-priff-herblore">
                            <div class="task-content">
                                <span class="task-name">Herblore Supplies</span>
                                <div class="subtask-list">
                                    <div class="subtask-item">
                                        <input type="checkbox" class="task-checkbox" data-task="mining-priff-vials">
                                        <span class="task-name">Vials</span>
                                    </div>
                                    <div class="subtask-item">
                                        <input type="checkbox" class="task-checkbox" data-task="mining-priff-eye-newt">
                                        <span class="task-name">Eye of newt</span>
                                    </div>
                                    <div class="subtask-item">
                                        <input type="checkbox" class="task-checkbox" data-task="mining-priff-herb-supplies">
                                        <span class="task-name">Herblore supplies</span>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="mining-motherlode-maw">
                            <div class="task-content">
                                <span class="task-name">Motherlode Maw</span>
                                <a href="https://runescape.wiki/w/Motherlode_Maw" class="task-link" target="_blank">Wiki Guide</a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="section-divider"></div>

            <!-- Herb Run Section -->
            <div class="section">
                <div class="section-header">
                    <div class="section-header-left">
                        <span class="section-emoji">üåø</span>
                        <h2>Herb Run</h2>
                        <span class="task-note">(Needs Ironman Information to be added)</span>
                        <button class="show-hidden-btn" onclick="toggleHiddenTasks('herb')" id="showHiddenHerb" style="display: none;">Show Hidden</button>
                    </div>
                </div>
                
                <div class="subsection">
                    <h3>üí∞ Profitability Calculator</h3>
                    <p style="margin-bottom: 15px; font-style: italic; color: #7f8c8d;">
                        <a href="https://runescape.wiki/w/Calculator:Farming/Herbs" class="task-link" target="_blank">Farming/Herbs Calculator</a>
                    </p>
                </div>

                <div class="subsection">
                    <h3>üå± Equip Farming Loadout & Activate Greenfingers Aura & Set Lunar Spellbook & Chug Juju Farming Potion</h3>
                    <ul class="task-list">
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="herb-desert-tp">
                            <div class="task-content">
                                <span class="task-name">Mystic Teleport to Desert</span>
                                <span class="task-note">Collect 8 Ultracompost - Gather and Plant</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="herb-troll-farm">
                            <div class="task-content">
                                <span class="task-name">Troll Farm Teleport</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="herb-catherby">
                            <div class="task-content">
                                <span class="task-name">Farming Amulet TP to Catherby</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="herb-cabbage-port">
                            <div class="task-content">
                                <span class="task-name">Cabbage Port</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="herb-morytania">
                            <div class="task-content">
                                <span class="task-name">Morytania</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="herb-manor-farm">
                            <div class="task-content">
                                <span class="task-name">Manor Farm</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="herb-crwys">
                            <div class="task-content">
                                <span class="task-name">Ancient Crystal Seed - Crwys 5</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="herb-wilderness">
                            <div class="task-content">
                                <span class="task-name">Wilderness</span>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="subsection">
                    <h3>‚öîÔ∏è War's Retreat & Ancient Spellbook & Store Dwarven Harvester</h3>
                    <ul class="task-list">
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="herb-wars-desert">
                            <div class="task-content">
                                <span class="task-name">Mystic Teleport to Desert</span>
                                <span class="task-note">Collect 8 Ultracompost</span>
                            </div>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="herb-hets-oasis">
                            <div class="task-content">
                                <span class="task-name">Het's Oasis RAPID GROWTH for Golden Roses</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="section-divider"></div>

            <!-- Necromancy Section -->
            <div class="section">
                <div class="section-header">
                    <div class="section-header-left">
                        <span class="section-emoji">üíÄ</span>
                        <h2>Necromancy Run</h2>
                        <button class="show-hidden-btn" onclick="toggleHiddenTasks('necro')" id="showHiddenNecro" style="display: none;">Show Hidden</button>
                    </div>
                </div>
                <ul class="task-list">
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="necro-lupe">
                        <div class="task-content">
                            <span class="task-name">Gather free supplies from Lupe</span>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="necro-slime">
                        <div class="task-content">
                            <span class="task-name">Gather Slime</span>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="necro-ectoplasm">
                        <div class="task-content">
                            <span class="task-name">5x Rituals - Ectoplasm</span>
                            <span class="task-note">(Main site)</span>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="necro-essence">
                        <div class="task-content">
                            <span class="task-name">5x Rituals - Necro Essence</span>
                            <span class="task-note">(Vorkath site)</span>
                        </div>
                    </li>
                </ul>
            </div>

            <div class="section-divider"></div>

            <!-- Shop Runs Section -->
            <div class="section">
                <div class="section-header">
                    <div class="section-header-left">
                        <span class="section-emoji">üõí</span>
                        <h2>Generic Collectibles and Shop Runs</h2>
                        <button class="show-hidden-btn" onclick="toggleHiddenTasks('shop')" id="showHiddenShop" style="display: none;">Show Hidden</button>
                    </div>
                </div>
                <ul class="task-list">
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="shop-culinaromancer">
                        <div class="task-content">
                            <span class="task-name">Culinaromancer's Chest</span>
                            <a href="https://runescape.wiki/w/Culinaromancer%27s_Chest" class="task-link" target="_blank">Wiki Guide</a>
                            <span class="task-note">in Lumbridge Castle</span>
                            <div class="subtask-list">
                                <div class="subtask-item">
                                    <input type="checkbox" class="task-checkbox" data-task="shop-food">
                                    <span class="task-name">Buy all food items</span>
                                </div>
                                <div class="subtask-item">
                                    <input type="checkbox" class="task-checkbox" data-task="shop-gloves">
                                    <span class="task-name">Buy gloves and disassemble</span>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="shop-maat">
                        <div class="task-content">
                            <span class="task-name">Feather of Ma'at</span>
                            <a href="https://runescape.wiki/w/Money_making_guide/Buying_feathers_of_Ma%27at" class="task-link" target="_blank">Money Making Guide</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="shop-feathers">
                        <div class="task-content">
                            <span class="task-name">Feather Shop Run</span>
                            <a href="https://runescape.wiki/w/Money_making_guide/Buying_feathers" class="task-link" target="_blank">Money Making Guide</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="shop-yak">
                        <div class="task-content">
                            <span class="task-name">Yak Hide</span>
                            <a href="https://runescape.wiki/w/Money_making_guide/Buying_yak-hide" class="task-link" target="_blank">Money Making Guide</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="shop-seaweed">
                        <div class="task-content">
                            <span class="task-name">Seaweed and Pineapple</span>
                            <a href="https://runescape.wiki/w/Money_making_guide/Buying_seaweed_and_pineapples_from_Arhein" class="task-link" target="_blank">Money Making Guide</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="shop-potato">
                        <div class="task-content">
                            <span class="task-name">Potato Cactus from Wise Old Man</span>
                            <a href="https://runescape.wiki/w/Weird_Old_Man" class="task-link" target="_blank">Weird Old Man</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="shop-planks">
                        <div class="task-content">
                            <span class="task-name">Planks from Razmire</span>
                            <a href="https://runescape.wiki/w/Razmire_Keelgan" class="task-link" target="_blank">Razmire Keelgan</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="shop-flax">
                        <div class="task-content">
                            <span class="task-name">Flax from Geoffrey</span>
                            <a href="https://runescape.wiki/w/Geoffrey" class="task-link" target="_blank">Geoffrey</a>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" class="task-checkbox" data-task="shop-fruit">
                        <div class="task-content">
                            <span class="task-name">Pineapples and Apples from Dell Monti</span>
                            <a href="https://runescape.wiki/w/Dell_Monti" class="task-link" target="_blank">Dell Monti</a>
                        </div>
                    </li>
                </ul>
            </div>

            <!-- Notes Section -->
            <div class="notes-section">
                <h3>üìù Abbreviations</h3>
                <div class="notes-list">
                    <div class="note-item"><strong>FC</strong> = Friends Chat</div>
                    <div class="note-item"><strong>TP</strong> = Teleport</div>
                    <div class="note-item"><strong>POF</strong> = Player-owned Farm</div>
                    <div class="note-item"><strong>RC</strong> = Runecrafting</div>
                    <div class="note-item"><strong>GWD2</strong> = God Wars Dungeon 2</div>
                    <div class="note-item"><strong>D&D</strong> = Distractions and Diversions</div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Last updated: December 6, 2025 | Your progress is saved locally in your browser</p>
        </div>
    </div>

    <script>
        // Profile Management System
        let currentProfile = null;
        const STORAGE_KEY = 'rs3-repeatables-profiles';
        const LEGACY_KEY = 'rs3-repeatables-progress';
        const GLOBAL_SETTINGS_KEY = 'rs3-global-settings';

        // Timer System
        let timerInterval = null;
        let lastResetCheck = {
            daily: null,
            weekly: null,
            monthly: null
        };

        // Menu System
        let activeContextMenu = null;
        let contextMenuTarget = null;

        // Global Settings
        let globalSettings = {
            hiddenTasks: [],
            useGlobalHiding: true,
            lastResetCheck: { daily: null, weekly: null, monthly: null }
        };

        // Load saved progress when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeGlobalSettings();
            initializeProfileSystem();
            initializeTimerSystem();
            initializeMenuSystem();
            
            // Add event listeners to all checkboxes
            const checkboxes = document.querySelectorAll('.task-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    // Update parent task state if this is a subtask
                    updateParentTaskState(this);
                    saveProgress();
                    updateProgress();
                    updateTaskAppearance(this);
                });
                
                // Make checkbox clicks behave the same as task clicks for parent tasks
                checkbox.addEventListener('click', function(event) {
                    const taskItem = this.closest('.task-item');
                    const subtaskItem = this.closest('.subtask-item');
                    
                    // If this is a subtask checkbox, let it behave normally
                    if (subtaskItem) {
                        return; // Allow normal checkbox behavior for subtasks
                    }
                    
                    // Only handle parent task checkboxes specially
                    const subtasks = taskItem?.querySelectorAll('.subtask-item .task-checkbox');
                    if (subtasks && subtasks.length > 0) {
                        // This is a parent task checkbox - allow the click but then sync children
                        // Don't prevent default - let the checkbox toggle naturally
                        setTimeout(() => {
                            // After the checkbox state changes, sync all children to match
                            const isChecked = this.checked;
                            subtasks.forEach(subtaskCheckbox => {
                                subtaskCheckbox.checked = isChecked;
                                const changeEvent = new Event('change', { bubbles: true });
                                subtaskCheckbox.dispatchEvent(changeEvent);
                            });
                        }, 0);
                    }
                });
            });

            // Add click event listeners to task items for better UX
            const taskItems = document.querySelectorAll('.task-item');
            taskItems.forEach(taskItem => {
                // Right-click context menu
                taskItem.addEventListener('contextmenu', function(event) {
                    event.preventDefault();
                    showTaskContextMenu(event, this);
                });

                taskItem.addEventListener('click', function(event) {
                    // Don't toggle if clicking on links, buttons, or the checkbox itself
                    if (event.target.tagName === 'A' ||
                        event.target.tagName === 'BUTTON' ||
                        event.target.classList.contains('task-checkbox') ||
                        event.target.closest('a') ||
                        event.target.closest('button') ||
                        event.target.closest('.subtask-item')) {
                        return;
                    }
                    
                    // Find the main checkbox in this task item (not subtask checkboxes)
                    const mainCheckbox = taskItem.querySelector(':scope > .task-checkbox');
                    if (mainCheckbox) {
                        toggleTaskWithChildren(mainCheckbox, taskItem);
                    }
                });
            });

            // Add click event listeners to subtask items
            const subtaskItems = document.querySelectorAll('.subtask-item');
            subtaskItems.forEach(subtaskItem => {
                // Right-click context menu for subtasks
                subtaskItem.addEventListener('contextmenu', function(event) {
                    event.preventDefault();
                    event.stopPropagation();
                    showTaskContextMenu(event, this);
                });

                subtaskItem.addEventListener('click', function(event) {
                    // Don't toggle if clicking on links, buttons, or the checkbox itself
                    if (event.target.tagName === 'A' ||
                        event.target.tagName === 'BUTTON' ||
                        event.target.classList.contains('task-checkbox') ||
                        event.target.closest('a') ||
                        event.target.closest('button')) {
                        return;
                    }
                    
                    // Stop event from bubbling to parent task
                    event.stopPropagation();
                    
                    // Find the checkbox in this subtask item
                    const checkbox = subtaskItem.querySelector('.task-checkbox');
                    if (checkbox) {
                        // Toggle the checkbox
                        checkbox.checked = !checkbox.checked;
                        
                        // Trigger the change event to save progress and update appearance
                        const changeEvent = new Event('change', { bubbles: true });
                        checkbox.dispatchEvent(changeEvent);
                    }
                });
            });

            // Close menus when clicking outside
            document.addEventListener('click', function(event) {
                if (!event.target.closest('.hamburger-menu') && !event.target.closest('#hamburgerBtn')) {
                    closeHamburgerMenu();
                }
                if (!event.target.closest('.profile-dropdown') && !event.target.closest('#profileIcon')) {
                    closeProfileDropdown();
                }
                if (!event.target.closest('.task-context-menu')) {
                    closeTaskContextMenu();
                }
            });
        });

        // Global Settings Functions
        function initializeGlobalSettings() {
            const saved = localStorage.getItem(GLOBAL_SETTINGS_KEY);
            if (saved) {
                globalSettings = { ...globalSettings, ...JSON.parse(saved) };
            }
            
            // Migrate lastResetCheck from old location
            const oldResetCheck = localStorage.getItem('rs3-last-reset-check');
            if (oldResetCheck && !globalSettings.lastResetCheck.daily) {
                globalSettings.lastResetCheck = JSON.parse(oldResetCheck);
                saveGlobalSettings();
                localStorage.removeItem('rs3-last-reset-check');
            }
        }

        function saveGlobalSettings() {
            localStorage.setItem(GLOBAL_SETTINGS_KEY, JSON.stringify(globalSettings));
        }

        // Menu System Functions
        function initializeMenuSystem() {
            // Hamburger menu event listeners
            document.getElementById('hamburgerBtn').addEventListener('click', toggleHamburgerMenu);
            document.getElementById('hamburgerCloseBtn').addEventListener('click', closeHamburgerMenu);
            document.getElementById('menuBackdrop').addEventListener('click', closeAllMenus);

            // Profile dropdown event listeners
            document.getElementById('profileIcon').addEventListener('click', toggleProfileDropdown);
            document.getElementById('profileDropdownSelect').addEventListener('change', switchProfileFromDropdown);
            document.getElementById('profileDropdownCreate').addEventListener('click', createProfileFromDropdown);
            document.getElementById('profileDropdownDelete').addEventListener('click', deleteProfileFromDropdown);

            // Hamburger menu controls
            document.getElementById('hamburgerDensitySlider').addEventListener('input', function() {
                updateDensityFromHamburger(this.value);
            });
            document.getElementById('hamburgerColumnsSelect').addEventListener('change', function() {
                updateColumnsFromHamburger(this.value);
            });
            document.getElementById('useGlobalHiding').addEventListener('change', function() {
                globalSettings.useGlobalHiding = this.checked;
                saveGlobalSettings();
                applyTaskHiding();
            });

            // Initialize hamburger menu values
            updateHamburgerMenuValues();
        }

        function toggleHamburgerMenu() {
            const menu = document.getElementById('hamburgerMenu');
            const backdrop = document.getElementById('menuBackdrop');
            
            if (menu.classList.contains('open')) {
                closeHamburgerMenu();
            } else {
                closeProfileDropdown();
                menu.classList.add('open');
                backdrop.classList.add('show');
                updateHamburgerMenuValues();
            }
        }

        function closeHamburgerMenu() {
            const menu = document.getElementById('hamburgerMenu');
            const backdrop = document.getElementById('menuBackdrop');
            menu.classList.remove('open');
            backdrop.classList.remove('show');
        }

        function toggleProfileDropdown() {
            const dropdown = document.getElementById('profileDropdown');
            
            if (dropdown.classList.contains('open')) {
                closeProfileDropdown();
            } else {
                closeHamburgerMenu();
                dropdown.classList.add('open');
                updateProfileDropdownValues();
                updateProfileIcon();
            }
        }

        function closeProfileDropdown() {
            const dropdown = document.getElementById('profileDropdown');
            dropdown.classList.remove('open');
        }

        function closeAllMenus() {
            closeHamburgerMenu();
            closeProfileDropdown();
            closeTaskContextMenu();
        }

        function updateHamburgerMenuValues() {
            const profiles = getProfiles();
            const profile = currentProfile ? profiles[currentProfile] : null;
            
            // Update density slider
            const densitySlider = document.getElementById('hamburgerDensitySlider');
            const densityValue = document.getElementById('hamburgerDensityValue');
            const currentDensity = profile?.settings?.density || 3;
            densitySlider.value = currentDensity;
            
            const densityLabels = { 1: 'Very Tight', 2: 'Tight', 3: 'Normal', 4: 'Loose', 5: 'Very Loose' };
            densityValue.textContent = densityLabels[currentDensity];
            
            // Update columns select
            const columnsSelect = document.getElementById('hamburgerColumnsSelect');
            const currentColumns = profile?.settings?.columns || 1;
            columnsSelect.value = currentColumns;
            
            // Update global hiding checkbox
            const globalHidingCheckbox = document.getElementById('useGlobalHiding');
            globalHidingCheckbox.checked = globalSettings.useGlobalHiding;
        }

        function updateProfileDropdownValues() {
            const profiles = getProfiles();
            const select = document.getElementById('profileDropdownSelect');
            
            // Clear and populate dropdown
            select.innerHTML = '<option value="">Select Profile...</option>';
            Object.keys(profiles).forEach(profileId => {
                const option = document.createElement('option');
                option.value = profileId;
                option.textContent = profiles[profileId].name;
                select.appendChild(option);
            });
            
            // Set current selection
            if (currentProfile) {
                select.value = currentProfile;
            }
            
            // Update delete button state
            const deleteBtn = document.getElementById('profileDropdownDelete');
            deleteBtn.disabled = !currentProfile;
        }

        function updateProfileIcon() {
            const profileIcon = document.getElementById('profileIcon');
            const profiles = getProfiles();
            
            if (currentProfile && profiles[currentProfile]) {
                const profileName = profiles[currentProfile].name;
                profileIcon.textContent = profileName.charAt(0).toUpperCase();
                profileIcon.classList.add('active');
            } else {
                profileIcon.textContent = '?';
                profileIcon.classList.remove('active');
            }
        }

        function updateDensityFromHamburger(value) {
            updateDensity(value);
            saveProfileSettings();
            
            // Update display
            const densityLabels = { 1: 'Very Tight', 2: 'Tight', 3: 'Normal', 4: 'Loose', 5: 'Very Loose' };
            document.getElementById('hamburgerDensityValue').textContent = densityLabels[value];
        }

        function updateColumnsFromHamburger(value) {
            updateColumns(value);
            saveProfileSettings();
        }

        function switchProfileFromDropdown() {
            const select = document.getElementById('profileDropdownSelect');
            const profileId = select.value;
            
            if (profileId) {
                switchToProfile(profileId);
            } else {
                currentProfile = null;
                localStorage.removeItem('rs3-last-profile');
                clearAllCheckboxes();
                updateProgress();
            }
            updateProfileIcon();
            closeProfileDropdown();
        }

        function createProfileFromDropdown() {
            createProfile();
            updateProfileDropdownValues();
            updateProfileIcon();
        }

        function deleteProfileFromDropdown() {
            deleteProfile();
            updateProfileDropdownValues();
            updateProfileIcon();
        }

        // Task Context Menu Functions
        function showTaskContextMenu(event, taskElement) {
            const contextMenu = document.getElementById('taskContextMenu');
            contextMenuTarget = taskElement;
            
            // Position the menu
            contextMenu.style.left = event.pageX + 'px';
            contextMenu.style.top = event.pageY + 'px';
            contextMenu.classList.add('show');
            
            // Update menu text based on task state
            const checkbox = taskElement.querySelector('.task-checkbox');
            const taskId = checkbox?.dataset.task;
            const isHidden = isTaskHidden(taskId);
            
            const hideItem = contextMenu.querySelector('.hide');
            hideItem.textContent = isHidden ? 'Show Task' : 'Hide Task';
        }

        function closeTaskContextMenu() {
            const contextMenu = document.getElementById('taskContextMenu');
            contextMenu.classList.remove('show');
            contextMenuTarget = null;
        }

        function hideTask() {
            if (!contextMenuTarget) return;
            
            const checkbox = contextMenuTarget.querySelector('.task-checkbox');
            const taskId = checkbox?.dataset.task;
            
            if (taskId) {
                toggleTaskHidden(taskId);
                applyTaskHiding();
                updateShowHiddenButtons();
            }
            
            closeTaskContextMenu();
        }

        // Task Hiding Functions
        function isTaskHidden(taskId) {
            if (!taskId) return false;
            
            if (globalSettings.useGlobalHiding) {
                return globalSettings.hiddenTasks.includes(taskId);
            } else {
                const profiles = getProfiles();
                const profile = currentProfile ? profiles[currentProfile] : null;
                return profile?.settings?.hiddenTasks?.includes(taskId) || false;
            }
        }

        function toggleTaskHidden(taskId) {
            if (!taskId) return;
            
            if (globalSettings.useGlobalHiding) {
                const index = globalSettings.hiddenTasks.indexOf(taskId);
                if (index > -1) {
                    globalSettings.hiddenTasks.splice(index, 1);
                } else {
                    globalSettings.hiddenTasks.push(taskId);
                }
                saveGlobalSettings();
            } else {
                if (!currentProfile) return;
                
                const profiles = getProfiles();
                const profile = profiles[currentProfile];
                if (!profile.settings) profile.settings = {};
                if (!profile.settings.hiddenTasks) profile.settings.hiddenTasks = [];
                
                const index = profile.settings.hiddenTasks.indexOf(taskId);
                if (index > -1) {
                    profile.settings.hiddenTasks.splice(index, 1);
                } else {
                    profile.settings.hiddenTasks.push(taskId);
                }
                saveProfiles(profiles);
            }
        }

        function applyTaskHiding() {
            const allTasks = document.querySelectorAll('.task-item, .subtask-item');
            
            allTasks.forEach(taskElement => {
                const checkbox = taskElement.querySelector('.task-checkbox');
                const taskId = checkbox?.dataset.task;
                
                if (taskId && isTaskHidden(taskId)) {
                    taskElement.classList.add('hidden');
                } else {
                    taskElement.classList.remove('hidden');
                }
            });
            
            updateProgress();
        }

        function toggleHiddenTasks(sectionPrefix) {
            const button = document.getElementById(`showHidden${sectionPrefix.charAt(0).toUpperCase() + sectionPrefix.slice(1)}`);
            const isShowing = button.classList.contains('active');
            
            // Get all hidden tasks in this section
            const sectionTasks = document.querySelectorAll(`[data-task^="${sectionPrefix}-"]`);
            const hiddenTasks = Array.from(sectionTasks).filter(checkbox => {
                const taskId = checkbox.dataset.task;
                return isTaskHidden(taskId);
            });
            
            hiddenTasks.forEach(checkbox => {
                const taskElement = checkbox.closest('.task-item, .subtask-item');
                if (isShowing) {
                    // Hide them again
                    taskElement.classList.add('hidden');
                } else {
                    // Show them temporarily
                    taskElement.classList.remove('hidden');
                }
            });
            
            // Update button state
            if (isShowing) {
                button.classList.remove('active');
                button.textContent = 'Show Hidden';
            } else {
                button.classList.add('active');
                button.textContent = 'Hide Hidden';
            }
        }

        function updateShowHiddenButtons() {
            const sections = ['monthly', 'weekly', 'daily', 'fort', 'pof', 'rc', 'mining', 'herb', 'necro', 'shop'];
            
            sections.forEach(section => {
                const button = document.getElementById(`showHidden${section.charAt(0).toUpperCase() + section.slice(1)}`);
                if (!button) return;
                
                // Check if there are any hidden tasks in this section
                const sectionTasks = document.querySelectorAll(`[data-task^="${section}-"]`);
                const hasHiddenTasks = Array.from(sectionTasks).some(checkbox => {
                    const taskId = checkbox.dataset.task;
                    return isTaskHidden(taskId);
                });
                
                if (hasHiddenTasks) {
                    button.style.display = 'inline-block';
                } else {
                    button.style.display = 'none';
                    button.classList.remove('active');
                }
            });
        }

        function saveProfileSettings() {
            if (!currentProfile) return;
            
            const profiles = getProfiles();
            const profile = profiles[currentProfile];
            if (!profile.settings) profile.settings = {};
            
            // Get current density and columns from CSS
            const root = document.documentElement;
            const currentDensity = document.getElementById('hamburgerDensitySlider')?.value || 3;
            const currentColumns = document.getElementById('hamburgerColumnsSelect')?.value || 1;
            
            profile.settings.density = parseInt(currentDensity);
            profile.settings.columns = parseInt(currentColumns);
            profile.lastUpdated = new Date().toISOString();
            
            saveProfiles(profiles);
        }

        // Timer System Functions
        function initializeTimerSystem() {
            // Use global settings for reset check times
            lastResetCheck = globalSettings.lastResetCheck;

            // Add timer classes to timer elements
            document.getElementById('daily-timer').classList.add('daily');
            document.getElementById('weekly-timer').classList.add('weekly');
            document.getElementById('monthly-timer').classList.add('monthly');

            // Start the timer updates
            updateTimers();
            timerInterval = setInterval(updateTimers, 1000);

            // Check for auto-resets on page load
            checkForAutoResets();
        }

        function updateTimers() {
            const now = new Date();
            
            // Calculate next reset times
            const nextDaily = getNextDailyReset(now);
            const nextWeekly = getNextWeeklyReset(now);
            const nextMonthly = getNextMonthlyReset(now);

            // Update timer displays
            updateTimerDisplay('daily-timer', nextDaily, now);
            updateTimerDisplay('weekly-timer', nextWeekly, now);
            updateTimerDisplay('monthly-timer', nextMonthly, now);
        }

        function getNextDailyReset(now) {
            const nextReset = new Date(now);
            nextReset.setUTCHours(0, 0, 0, 0);
            nextReset.setUTCDate(nextReset.getUTCDate() + 1);
            return nextReset;
        }

        function getNextWeeklyReset(now) {
            const nextReset = new Date(now);
            nextReset.setUTCHours(0, 0, 0, 0);
            
            // Find next Wednesday (day 3, where Sunday = 0)
            const daysUntilWednesday = (3 - nextReset.getUTCDay() + 7) % 7;
            if (daysUntilWednesday === 0 && now.getUTCHours() >= 0) {
                // If it's Wednesday and past reset time, go to next Wednesday
                nextReset.setUTCDate(nextReset.getUTCDate() + 7);
            } else {
                nextReset.setUTCDate(nextReset.getUTCDate() + daysUntilWednesday);
            }
            
            return nextReset;
        }

        function getNextMonthlyReset(now) {
            const nextReset = new Date(now);
            nextReset.setUTCHours(0, 0, 0, 0);
            nextReset.setUTCDate(1);
            nextReset.setUTCMonth(nextReset.getUTCMonth() + 1);
            return nextReset;
        }

        function updateTimerDisplay(timerId, nextReset, now) {
            const timer = document.getElementById(timerId);
            const timeDiff = nextReset - now;

            if (timeDiff <= 0) {
                timer.textContent = 'RESET!';
                timer.classList.add('expired');
                return;
            }

            timer.classList.remove('expired');

            const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);

            let timeString = '';
            if (days > 0) {
                timeString = `${days}d ${hours}h ${minutes}m ${seconds}s`;
            } else if (hours > 0) {
                timeString = `${hours}h ${minutes}m ${seconds}s`;
            } else {
                timeString = `${minutes}m ${seconds}s`;
            }

            timer.textContent = timeString;
        }

        function checkForAutoResets() {
            const now = new Date();
            const currentDay = now.toDateString();
            const currentWeek = getWeekKey(now);
            const currentMonth = `${now.getUTCFullYear()}-${now.getUTCMonth()}`;

            let resetOccurred = false;
            let resetTypes = [];

            // Check daily reset
            if (lastResetCheck.daily !== currentDay && hasPassedDailyReset(now)) {
                performGlobalReset('daily');
                lastResetCheck.daily = currentDay;
                resetOccurred = true;
                resetTypes.push('daily');
            }

            // Check weekly reset
            if (lastResetCheck.weekly !== currentWeek && hasPassedWeeklyReset(now)) {
                performGlobalReset('weekly');
                lastResetCheck.weekly = currentWeek;
                resetOccurred = true;
                resetTypes.push('weekly');
            }

            // Check monthly reset
            if (lastResetCheck.monthly !== currentMonth && hasPassedMonthlyReset(now)) {
                performGlobalReset('monthly');
                lastResetCheck.monthly = currentMonth;
                resetOccurred = true;
                resetTypes.push('monthly');
            }

            if (resetOccurred) {
                globalSettings.lastResetCheck = lastResetCheck;
                saveGlobalSettings();
                showAutoResetNotification(resetTypes);
            }
        }

        function performGlobalReset(resetType) {
            const profiles = getProfiles();
            let affectedProfiles = 0;

            Object.keys(profiles).forEach(profileId => {
                const profile = profiles[profileId];
                let tasksReset = false;

                if (resetType === 'daily') {
                    tasksReset = resetProfileDailyTasks(profile);
                } else if (resetType === 'weekly') {
                    tasksReset = resetProfileWeeklyTasks(profile);
                } else if (resetType === 'monthly') {
                    tasksReset = resetProfileMonthlyTasks(profile);
                }

                if (tasksReset) {
                    profile.lastUpdated = new Date().toISOString();
                    affectedProfiles++;
                }
            });

            if (affectedProfiles > 0) {
                saveProfiles(profiles);
                
                // If current profile was affected, reload the UI
                if (currentProfile && profiles[currentProfile]) {
                    loadProgress();
                    updateProgress();
                }
            }

            return affectedProfiles;
        }

        function resetProfileDailyTasks(profile) {
            if (!profile.progress) return false;
            
            const dailyPrefixes = ['daily-', 'fort-', 'pof-', 'rc-', 'mining-', 'herb-', 'necro-', 'shop-'];
            let tasksReset = false;

            Object.keys(profile.progress).forEach(taskId => {
                if (dailyPrefixes.some(prefix => taskId.startsWith(prefix)) && profile.progress[taskId]) {
                    profile.progress[taskId] = false;
                    tasksReset = true;
                }
            });

            return tasksReset;
        }

        function resetProfileWeeklyTasks(profile) {
            if (!profile.progress) return false;
            
            let tasksReset = false;
            Object.keys(profile.progress).forEach(taskId => {
                if (taskId.startsWith('weekly-') && profile.progress[taskId]) {
                    profile.progress[taskId] = false;
                    tasksReset = true;
                }
            });

            return tasksReset;
        }

        function resetProfileMonthlyTasks(profile) {
            if (!profile.progress) return false;
            
            let tasksReset = false;
            Object.keys(profile.progress).forEach(taskId => {
                if (taskId.startsWith('monthly-') && profile.progress[taskId]) {
                    profile.progress[taskId] = false;
                    tasksReset = true;
                }
            });

            return tasksReset;
        }

        function hasPassedDailyReset(now) {
            const todayReset = new Date(now);
            todayReset.setUTCHours(0, 0, 0, 0);
            return now >= todayReset;
        }

        function hasPassedWeeklyReset(now) {
            const thisWeekReset = new Date(now);
            thisWeekReset.setUTCHours(0, 0, 0, 0);
            const daysSinceWednesday = (now.getUTCDay() - 3 + 7) % 7;
            thisWeekReset.setUTCDate(thisWeekReset.getUTCDate() - daysSinceWednesday);
            return now >= thisWeekReset;
        }

        function hasPassedMonthlyReset(now) {
            const thisMonthReset = new Date(now);
            thisMonthReset.setUTCHours(0, 0, 0, 0);
            thisMonthReset.setUTCDate(1);
            return now >= thisMonthReset;
        }

        function getWeekKey(date) {
            const wednesday = new Date(date);
            const daysSinceWednesday = (date.getUTCDay() - 3 + 7) % 7;
            wednesday.setUTCDate(wednesday.getUTCDate() - daysSinceWednesday);
            return `${wednesday.getUTCFullYear()}-W${Math.ceil(wednesday.getUTCDate() / 7)}`;
        }

        function showAutoResetNotification(resetTypes = []) {
            const notification = document.createElement('div');
            notification.className = 'auto-reset-notification';
            
            const resetText = resetTypes.length > 0 ? resetTypes.join(', ') : 'tasks';
            notification.textContent = `üîÑ ${resetText} tasks have been automatically reset across all profiles!`;
            document.body.appendChild(notification);

            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 4000);
        }

        function initializeProfileSystem() {
            migrateLegacyData();
            loadProfiles();
            
            // Try to load the last used profile
            const lastProfile = localStorage.getItem('rs3-last-profile');
            if (lastProfile && getProfiles()[lastProfile]) {
                switchToProfile(lastProfile);
            }
        }

        function migrateLegacyData() {
            const legacyData = localStorage.getItem(LEGACY_KEY);
            if (legacyData) {
                const profiles = getProfiles();
                if (!profiles['Default']) {
                    profiles['Default'] = {
                        name: 'Default',
                        progress: JSON.parse(legacyData),
                        created: new Date().toISOString()
                    };
                    saveProfiles(profiles);
                    localStorage.removeItem(LEGACY_KEY);
                }
            }
        }

        function getProfiles() {
            const saved = localStorage.getItem(STORAGE_KEY);
            return saved ? JSON.parse(saved) : {};
        }

        function saveProfiles(profiles) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(profiles));
        }

        function loadProfiles() {
            // This function is now handled by updateProfileDropdownValues()
            // Keep for compatibility but don't do anything
        }

        function createProfile() {
            const profileName = prompt('Enter profile name:');
            if (!profileName || profileName.trim() === '') {
                return;
            }

            const trimmedName = profileName.trim();
            const profileId = generateProfileId(trimmedName);
            const profiles = getProfiles();

            // Check if profile already exists
            if (Object.values(profiles).some(p => p.name.toLowerCase() === trimmedName.toLowerCase())) {
                alert('A profile with this name already exists!');
                return;
            }

            profiles[profileId] = {
                name: trimmedName,
                progress: {},
                settings: {
                    density: 3,
                    columns: 1,
                    hiddenTasks: []
                },
                created: new Date().toISOString()
            };

            saveProfiles(profiles);
            loadProfiles();
            switchToProfile(profileId);
        }

        function deleteProfile() {
            if (!currentProfile) return;

            const profiles = getProfiles();
            const profileName = profiles[currentProfile].name;

            if (confirm(`Are you sure you want to delete the profile "${profileName}"? This cannot be undone.`)) {
                delete profiles[currentProfile];
                saveProfiles(profiles);
                
                // Clear current profile
                currentProfile = null;
                localStorage.removeItem('rs3-last-profile');
                
                // Reset UI - these elements no longer exist in the new design
                // Profile state is managed through the new dropdown system
                
                // Clear all checkboxes
                clearAllCheckboxes();
                updateProgress();
                loadProfiles();
            }
        }

        function switchProfile() {
            // This function is now handled by switchProfileFromDropdown()
            // Keep for compatibility but don't do anything
        }

        function switchToProfile(profileId) {
            const profiles = getProfiles();
            if (!profiles[profileId]) return;

            currentProfile = profileId;
            localStorage.setItem('rs3-last-profile', profileId);
            
            // Update UI - handled by updateProfileIcon() and dropdown system
            updateProfileIcon();
            
            // Load profile settings
            loadProfileSettings(profiles[profileId]);
            
            // Load profile progress
            loadProgress();
            
            // Apply task hiding and update UI
            applyTaskHiding();
            updateShowHiddenButtons();
            updateProgress();
            updateProfileIcon();
        }

        function loadProfileSettings(profile) {
            if (!profile.settings) return;
            
            // Load density setting
            if (profile.settings.density) {
                updateDensity(profile.settings.density);
                const densitySlider = document.getElementById('hamburgerDensitySlider');
                if (densitySlider) densitySlider.value = profile.settings.density;
            }
            
            // Load columns setting
            if (profile.settings.columns) {
                updateColumns(profile.settings.columns);
                const columnsSelect = document.getElementById('hamburgerColumnsSelect');
                if (columnsSelect) columnsSelect.value = profile.settings.columns;
            }
        }

        function generateProfileId(name) {
            return name.toLowerCase().replace(/[^a-z0-9]/g, '') + '_' + Date.now();
        }

        function saveProgress() {
            if (!currentProfile) return;

            const checkboxes = document.querySelectorAll('.task-checkbox');
            const progress = {};
            
            checkboxes.forEach(checkbox => {
                progress[checkbox.dataset.task] = checkbox.checked;
            });
            
            const profiles = getProfiles();
            if (profiles[currentProfile]) {
                profiles[currentProfile].progress = progress;
                profiles[currentProfile].lastUpdated = new Date().toISOString();
                saveProfiles(profiles);
            }
        }

        function loadProgress() {
            if (!currentProfile) {
                clearAllCheckboxes();
                return;
            }

            const profiles = getProfiles();
            const profile = profiles[currentProfile];
            
            if (profile && profile.progress) {
                // Clear all checkboxes first
                clearAllCheckboxes();
                
                // Load profile progress
                Object.keys(profile.progress).forEach(taskId => {
                    const checkbox = document.querySelector(`[data-task="${taskId}"]`);
                    if (checkbox) {
                        checkbox.checked = profile.progress[taskId];
                        updateTaskAppearance(checkbox);
                    }
                });
            } else {
                clearAllCheckboxes();
            }
        }

        function clearAllCheckboxes() {
            const checkboxes = document.querySelectorAll('.task-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
                updateTaskAppearance(checkbox);
            });
        }

        function updateProgress() {
            const checkboxes = document.querySelectorAll('.task-checkbox');
            
            // Filter out hidden tasks
            const visibleCheckboxes = Array.from(checkboxes).filter(checkbox => {
                const taskElement = checkbox.closest('.task-item, .subtask-item');
                return !taskElement.classList.contains('hidden');
            });
            
            const totalTasks = visibleCheckboxes.length;
            const completedTasks = visibleCheckboxes.filter(cb => cb.checked).length;
            const percentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = `${percentage}% Complete (${completedTasks}/${totalTasks} tasks)`;
        }

        function toggleTaskWithChildren(checkbox, taskItem) {
            const subtasks = taskItem.querySelectorAll('.subtask-item .task-checkbox');
            const newState = !checkbox.checked;
            
            // Set parent task state
            checkbox.checked = newState;
            
            // Set all subtasks to match parent state
            subtasks.forEach(subtaskCheckbox => {
                subtaskCheckbox.checked = newState;
                const changeEvent = new Event('change', { bubbles: true });
                subtaskCheckbox.dispatchEvent(changeEvent);
            });
            
            // Trigger change event for parent checkbox
            const changeEvent = new Event('change', { bubbles: true });
            checkbox.dispatchEvent(changeEvent);
        }
        
        function updateParentTaskState(checkbox) {
            const subtaskItem = checkbox.closest('.subtask-item');
            if (!subtaskItem) return; // Not a subtask
            
            const parentTaskItem = subtaskItem.closest('.task-item');
            if (!parentTaskItem) return;
            
            const parentCheckbox = parentTaskItem.querySelector(':scope > .task-checkbox');
            if (!parentCheckbox) return;
            
            const allSubtasks = parentTaskItem.querySelectorAll('.subtask-item .task-checkbox');
            const checkedSubtasks = parentTaskItem.querySelectorAll('.subtask-item .task-checkbox:checked');
            
            // If all subtasks are checked, check the parent
            // If no subtasks are checked, uncheck the parent
            // If some are checked, leave parent as is (could be enhanced with indeterminate state)
            if (checkedSubtasks.length === allSubtasks.length) {
                parentCheckbox.checked = true;
            } else if (checkedSubtasks.length === 0) {
                parentCheckbox.checked = false;
            }
            
            // Update parent appearance
            updateTaskAppearance(parentCheckbox);
        }

        function updateTaskAppearance(checkbox) {
            const taskItem = checkbox.closest('.task-item');
            const subtaskItem = checkbox.closest('.subtask-item');
            
            if (subtaskItem) {
                // Handle subtask appearance
                if (checkbox.checked) {
                    subtaskItem.classList.add('completed');
                } else {
                    subtaskItem.classList.remove('completed');
                }
            } else if (taskItem) {
                // Handle main task appearance
                if (checkbox.checked) {
                    taskItem.classList.add('completed');
                } else {
                    taskItem.classList.remove('completed');
                }
            }
        }

        function resetProgress() {
            if (!currentProfile) {
                alert('Please select a profile first.');
                return;
            }

            const profiles = getProfiles();
            const profileName = profiles[currentProfile].name;

            if (confirm(`Are you sure you want to reset all progress for "${profileName}"? This cannot be undone.`)) {
                profiles[currentProfile].progress = {};
                profiles[currentProfile].lastUpdated = new Date().toISOString();
                saveProfiles(profiles);
                
                clearAllCheckboxes();
                updateProgress();
            }
        }

        function resetMonthlyProgress(autoReset = false) {
            if (autoReset || confirm('Are you sure you want to reset all monthly task progress? This cannot be undone.')) {
                const monthlyCheckboxes = document.querySelectorAll('.task-checkbox[data-task^="monthly-"]');
                monthlyCheckboxes.forEach(checkbox => {
                    checkbox.checked = false;
                    updateTaskAppearance(checkbox);
                });
                saveProgress();
                updateProgress();
            }
        }

        function resetWeeklyProgress(autoReset = false) {
            if (autoReset || confirm('Are you sure you want to reset all weekly task progress? This cannot be undone.')) {
                const weeklyCheckboxes = document.querySelectorAll('.task-checkbox[data-task^="weekly-"]');
                weeklyCheckboxes.forEach(checkbox => {
                    checkbox.checked = false;
                    updateTaskAppearance(checkbox);
                });
                saveProgress();
                updateProgress();
            }
        }

        function resetDailyProgress(autoReset = false) {
            if (autoReset || confirm('Are you sure you want to reset all daily task progress? This cannot be undone.')) {
                const dailyPrefixes = ['daily-', 'fort-', 'pof-', 'rc-', 'mining-', 'herb-', 'necro-', 'shop-'];
                const dailyCheckboxes = document.querySelectorAll('.task-checkbox');
                
                dailyCheckboxes.forEach(checkbox => {
                    const taskId = checkbox.dataset.task;
                    if (dailyPrefixes.some(prefix => taskId.startsWith(prefix))) {
                        checkbox.checked = false;
                        updateTaskAppearance(checkbox);
                    }
                });
                saveProgress();
                updateProgress();
            }
        }

        function toggleCollapse(sectionId) {
            const content = document.getElementById(sectionId);
            const button = document.querySelector(`[onclick="toggleCollapse('${sectionId}')"]`);
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                button.classList.remove('collapsed');
                button.textContent = 'Collapse';
            } else {
                content.classList.add('collapsed');
                button.classList.add('collapsed');
                button.textContent = 'Expand';
            }
        }

        function updateDensity(value) {
            const root = document.documentElement;
            
            const densitySettings = {
                1: { spacing: '4px', padding: '6px', gap: '4px', label: 'Very Tight' },
                2: { spacing: '8px', padding: '8px', gap: '6px', label: 'Tight' },
                3: { spacing: '12px', padding: '12px', gap: '12px', label: 'Normal' },
                4: { spacing: '16px', padding: '16px', gap: '16px', label: 'Loose' },
                5: { spacing: '20px', padding: '20px', gap: '20px', label: 'Very Loose' }
            };
            
            const setting = densitySettings[value];
            root.style.setProperty('--task-spacing', setting.spacing);
            root.style.setProperty('--task-padding', setting.padding);
            root.style.setProperty('--task-gap', setting.gap);
            
            // Update hamburger menu display if it exists
            const hamburgerDensityValue = document.getElementById('hamburgerDensityValue');
            if (hamburgerDensityValue) {
                hamburgerDensityValue.textContent = setting.label;
            }
        }

        function updateColumns(value) {
            const root = document.documentElement;
            root.style.setProperty('--task-columns', value);
        }
    </script>
</body>
</html>
